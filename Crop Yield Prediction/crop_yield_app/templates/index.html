<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="/AgriTech/images/logo.png" />
    <meta charset="UTF-8" />
    <title>Crop Recommendation Result</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="{{ url_for('static', filename='theme.js') }}"></script>

    <style>
      /* === THEME VARIABLES AND TOGGLE LOGIC === */
      /* Light Mode (Default) */
      :root {
          --color-brand: #2d8f85;
          --color-highlight: #4caf50;
          --color-highlight-soft: rgba(76, 175, 80, 0.3);
          --color-gradient: linear-gradient(135deg, var(--color-brand), #1e6f67);
          --bg-page: #f0f9ff;
          --bg-card: #ffffff;
          --bg-header: rgba(255, 255, 255, 0.9);
          --bg-secondary-btn: transparent;
          --bg-hover-soft: #f9fdf9;
          --text-primary: #1e2f1e;
          --text-secondary: #4a5568;
          --border-color: #e2e8f0;
          --border-color-soft: rgba(45, 143, 133, 0.1);
          --shadow-light: rgba(42, 122, 42, 0.08);
          --shadow-medium: rgba(42, 122, 42, 0.15);
          --shadow-header: rgba(0, 0, 0, 0.05);
          --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          --border-radius: 12px;
          --border-radius-large: 24px;
      }

      /* Dark Mode */
      :root.dark-mode {
          --color-brand: #66c7b3; 
          --color-highlight: #81c784; 
          --color-highlight-soft: rgba(129, 199, 132, 0.3);
          --color-gradient: linear-gradient(135deg, #449c8f, #2d7a6e);
          --bg-page: #1a202c; 
          --bg-card: #2d3748; 
          --bg-header: rgba(45, 55, 72, 0.9);
          --bg-secondary-btn: transparent; 
          --bg-hover-soft: #394354;
          --text-primary: #e2e8f0;
          --text-secondary: #a0aec0;
          --border-color: #4a5568;
          --border-color-soft: rgba(102, 199, 179, 0.15);
          --shadow-light: rgba(0, 0, 0, 0.3);
          --shadow-medium: rgba(0, 0, 0, 0.5);
          --shadow-header: rgba(0, 0, 0, 0.4);
      }

      /* Theme Toggle Button Icon Visibility */
      .theme-toggle .fa-sun { display: block; }
      .theme-toggle .fa-moon { display: none; }
      :root.dark-mode .theme-toggle .fa-sun { display: none; }
      :root.dark-mode .theme-toggle .fa-moon { display: block; }
      :root.dark-mode .theme-text::before { content: "Dark Mode"; }
      .theme-text::before { content: "Light Mode"; }

      /* === BASE STYLES AND LAYOUT === */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      }

      body {
          font-family: "Poppins", sans-serif;
          background-color: var(--bg-page); 
          color: var(--text-primary);
          line-height: 1.6;
          min-height: 100vh;
          /*overflow-x: hidden;*/
          padding-top: 80px; /* Space for the sticky header */
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 2rem; 
      }

      /* Header */
      .sticky-header {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          background: var(--bg-header); 
          backdrop-filter: blur(10px);
          box-shadow: 0 2px 15px var(--shadow-header); 
          z-index: 100;
      }

      .header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 15px 0;
      }

      .app-logo {
          font-size: 1.8em;
          font-weight: 700;
          color: var(--color-brand);
          text-decoration: none;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      /* Main Layout (Two Columns) */
      .main-layout {
          display: grid;
          grid-template-columns: 2fr 1fr; /* 2/3 width for content, 1/3 for sidebar */
          gap: 40px;
          padding: 40px 2rem;
      }

      /* Main Heading */
      .header {
          text-align: left;
          margin-bottom: 40px;
          animation: fadeInUp 0.8s ease-out 0.2s both;
      }

      .header h1 {
          font-size: 3em;
          font-weight: 800;
          color: var(--color-brand);
          margin-bottom: 15px;
          position: relative;
          display: block; 
      }

      .header p {
          font-size: 1.1em;
          color: var(--text-secondary);
          max-width: 700px;
          margin: 0; 
          font-weight: 400;
      }

      /* Back Button/Nav Element Styling */
      .nav-back {
          display: inline-flex;
          align-items: center;
          gap: 8px;
          color: var(--text-secondary);
          text-decoration: none;
          font-weight: 500;
          padding: 10px 18px;
          background: var(--bg-card);
          border-radius: 50px;
          box-shadow: 0 4px 10px var(--shadow-light);
          transition: var(--transition);
          border: 1px solid var(--border-color);
          position: relative;
          overflow: hidden;
      }

      .back-btn-top {
          margin-bottom: 30px;
      }

      .nav-back:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px var(--shadow-medium);
          color: var(--color-brand);
      }

      .theme-toggle {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          color: var(--text-secondary);
          padding: 8px 12px;
          border-radius: 20px;
          font-size: 14px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 6px;
      }

      /* === RESULT CARD SECTION === */
      .result-card {
          background: var(--bg-card);
          border-radius: var(--border-radius-large);
          box-shadow: 0 10px 30px var(--shadow-medium);
          padding: 60px 40px;
          text-align: center;
          border: 1px solid var(--border-color-soft);
          animation: fadeInUp 0.8s ease-out 0.4s both;
      }

      .success-icon {
          width: 60px;
          height: 60px;
          margin: 0 auto 20px;
          background: var(--color-highlight);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #fff;
          font-size: 28px;
          font-weight: 600;
          animation: pulse 2s infinite;
          box-shadow: 0 0 0 0 var(--color-highlight-soft);
      }

      .result-value {
          font-size: 4em;
          font-weight: 900;
          color: var(--color-highlight);
          margin: 20px 0;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 15px;
          text-transform: capitalize;
      }

      .result-value i {
          font-size: 0.8em;
          color: var(--color-brand);
      }

      .insight-note {
          color: var(--text-secondary);
          font-size: 0.9em;
          line-height: 1.5;
          margin: 0;
      }

      .result-stats {
          display: flex;
          justify-content: space-around;
          padding-top: 30px;
          margin-top: 30px;
          border-top: 1px solid var(--border-color-soft);
      }

      .stat {
          text-align: center;
          font-size: 0.9em;
          color: var(--text-secondary);
          font-weight: 500;
      }

      .stat-icon {
          font-size: 1.5em;
          color: var(--color-brand);
          margin-bottom: 5px;
          display: block;
      }

      .stat-label {
          font-weight: 600;
          color: var(--text-primary);
      }


      /* === ACTION BUTTONS FIX (Side-by-side) === */
      .action-buttons-group {
          display: flex;
          flex-direction: row; 
          gap: 15px; /* Added spacing between buttons */
          margin-top: 40px;
          padding-top: 20px;
          border-top: 1px dashed var(--border-color-soft);
      }

      .action-buttons-group form,
      .action-buttons-group a {
          flex: 1; /* Makes buttons equal width */
          width: 50%; /* Fallback/explicit width */
      }

      .btn {
          width: 100%; 
          padding: 18px 30px;
          background: var(--color-gradient);
          color: #fff;
          border: none;
          border-radius: var(--border-radius);
          font-size: 1.05em;
          font-weight: 600;
          cursor: pointer;
          transition: var(--transition);
          position: relative;
          overflow: hidden;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          text-decoration: none;
          text-align: center;
      }

      .btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 30px var(--shadow-medium);
      }

      .btn-secondary {
          background: var(--bg-secondary-btn);
          color: var(--color-brand);
          border: 2px solid var(--color-brand);
          box-shadow: none;
      }

      .btn-secondary:hover {
          background: var(--color-brand);
          color: #fff;
          transform: translateY(-3px);
      }

      .btn.loading {
          pointer-events: none;
          opacity: 0.9;
      }

      /* === INSIGHTS SIDEBAR (Right Column) === */
      .content-right {
          padding-top: 70px; 
      }

      .yield-insights {
          background: var(--bg-card);
          border-radius: var(--border-radius-large);
          box-shadow: 0 10px 30px var(--shadow-medium);
          padding: 30px; 
          border: 1px solid var(--border-color-soft);
          animation: fadeInUp 0.8s ease-out 0.6s both;
      }

      .yield-insights h3 {
          color: var(--color-brand);
          font-size: 1.4em;
          margin-bottom: 25px;
          display: flex;
          align-items: center;
          gap: 12px;
          font-weight: 700;
          padding-bottom: 15px;
          border-bottom: 1px solid var(--border-color-soft);
      }

      .yield-insights ul {
          list-style: none;
      }

      .yield-insights li {
          display: flex;
          align-items: flex-start;
          gap: 15px;
          padding: 15px;
          margin-bottom: 10px;
          background: var(--bg-hover-soft);
          border-radius: var(--border-radius);
          box-shadow: 0 2px 5px var(--shadow-light);
          transition: var(--transition);
          border-left: 4px solid var(--color-highlight);
          opacity: 0;
          animation: slideInRight 0.6s ease-out forwards;
      }

      .yield-insights li:hover {
          transform: translateX(3px);
          box-shadow: 0 5px 15px var(--shadow-medium);
      }

      .yield-insights li i {
          color: var(--color-highlight);
          font-size: 1.4em;
          min-width: 20px;
          margin-top: 4px;
      }

      .yield-insights li strong {
          color: var(--text-primary);
          font-weight: 600;
          margin-bottom: 2px;
          display: block;
      }

      /* === ANIMATIONS === */
      @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
      }

      @keyframes slideInRight {
          from { opacity: 0; transform: translateX(-20px); }
          to { opacity: 1; transform: translateX(0); }
      }

      @keyframes pulse {
          0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 var(--color-highlight-soft); }
          50% { transform: scale(1.05); box-shadow: 0 0 0 15px var(--color-highlight-soft); }
      }

      /* Animation Delays for Sidebar */
      .yield-insights li:nth-child(1) { animation-delay: 0.8s; }
      .yield-insights li:nth-child(2) { animation-delay: 0.9s; }
      .yield-insights li:nth-child(3) { animation-delay: 1.0s; }
      .yield-insights li:nth-child(4) { animation-delay: 1.1s; }

      /* === RESPONSIVE DESIGN === */
      @media (max-width: 1024px) {
          .main-layout {
              grid-template-columns: 1fr; 
              padding: 40px 1rem;
          }

          .header h1 {
              font-size: 2.5em;
          }

          .container {
              padding: 0 1rem;
          }

          .content-right {
              padding-top: 0;
          }
      }

      @media (max-width: 600px) {
          .action-buttons-group {
              /* For mobile, stack the buttons vertically */
              flex-direction: column; 
          }
          
          .header h1 {
              font-size: 2em;
          }
          .result-value {
              font-size: 3em;
              flex-direction: column;
              gap: 5px;
          }
          .result-stats {
              flex-direction: column;
              gap: 15px;
          }
          .result-card {
              padding: 30px 20px;
          }
          .header-content {
              padding: 10px 1rem;
          }
      }
    </style>
    </head>
  <body>
    <header class="sticky-header">
      <div class="container header-content">
        <a href="/" class="app-logo">
          <i class="fas fa-leaf"></i> AgriTech
        </a>
        
        <div class="header-actions">
          <button
            class="theme-toggle nav-back"
            aria-label="Toggle dark/light mode"
            id="theme-toggle-btn"
          >
            <i class="fas fa-sun sun-icon"></i>
            <i class="fas fa-moon moon-icon"></i>
            <span class="theme-text"></span> 
          </button>
        </div>
      </div>
    </header>

    <main class="main-layout container">
      <div class="content-left">
        <a href="javascript:history.back()" class="nav-back back-btn-top">
          <i class="fas fa-arrow-left"></i> Back to Input
        </a>

        <div class="header">
          <h1>Optimal Crop yield prediction 🎯</h1>
          <p>
            Based on your provided soil and climate data, the following crop is
            highly recommended for maximum yield and sustainability.
          </p>
        </div>

        <div class="result-card">
          <div class="success-icon">✓</div>
          <div class="result-value">
            <i class="fas fa-seedling"></i>
            <span class="recommended-crop">{{ crop | capitalize }}</span>
          </div>
          <p class="insight-note">
            This is the most suitable crop for your current soil nutrient profile.
          </p>
          
          <div class="result-stats">
            <div class="stat">
                <i class="fas fa-vial stat-icon"></i> 
                <span class="stat-label">Nitrogen (N): {{ params.N }}</span>
            </div>
            <div class="stat">
                <i class="fas fa-flask stat-icon"></i> 
                <span class="stat-label">Phosphorus (P): {{ params.P }}</span>
            </div>
            <div class="stat">
                <i class="fas fa-microscope stat-icon"></i> 
                <span class="stat-label">Potassium (K): {{ params.K }}</span>
            </div>
          </div>
        </div>

        <div class="action-buttons-group">
          <form method="post" action="/download_report">
            {% for key, value in params.items() %}
            <input type="hidden" name="{{ key }}" value="{{ value }}" />
            {% endfor %}
            <input type="hidden" name="crop" value="{{ crop }}" />
            
            <button
              type="submit"
              class="btn btn-primary"
              onclick="this.classList.add('loading'); this.innerHTML='<i class=\'fas fa-spinner fa-spin\'></i> Generating PDF...';"
            >
              <i class="fas fa-file-pdf"></i> Download Full Report
            </button>
          </form>

          <a href="/" class="btn btn-secondary">
            <i class="fas fa-redo-alt"></i> New Analysis
          </a>
        </div>
      </div>

      <div class="content-right">
        <div class="yield-insights">
          <h3><i class="fas fa-chart-line"></i> Input Details</h3>
          <ul>
            <li>
              <i class="fas fa-thermometer-half"></i>
              <div>
                <strong>Temperature</strong>
                <p class="insight-note">{{ params.temperature }}°C</p>
              </div>
            </li>
            <li>
              <i class="fas fa-cloud-showers-heavy"></i>
              <div>
                <strong>Climate Data</strong>
                <p class="insight-note">Rainfall: {{ params.rainfall }} mm | Humidity: {{ params.humidity }}%</p>
              </div>
            </li>
            <li>
              <i class="fas fa-tint"></i>
              <div>
                <strong>Soil pH Level</strong>
                <p class="insight-note">pH: {{ params.ph }}</p>
              </div>
            </li>
            <li>
              <i class="fas fa-map-marker-alt"></i>
              <div>
                <strong>Location Context</strong>
                <p class="insight-note">Analyzed for local conditions.</p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </main>
    
    <script>
      function createConfetti() {
        const colors = ["#4caf50", "#2d8f85", "#66bb6a", "#81c784"];
        const style = document.createElement("style");
        style.textContent = `@keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }`;
        document.head.appendChild(style);

        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.style.cssText = `
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${colors[Math.floor(Math.random() * colors.length)]};
            left: ${Math.random() * 100}vw;
            animation: fall ${Math.random() * 3 + 2}s linear forwards;
            z-index: 1000;
            border-radius: 50%;
          `;
          document.body.appendChild(confetti);
          setTimeout(() => { confetti.remove(); }, 5000);
        }
      }
      setTimeout(createConfetti, 1000);
      
      // Theme Toggle Fallback 
      const themeToggleBtn = document.getElementById('theme-toggle-btn');
      themeToggleBtn.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark-mode');
      });
    </script>
  </body>
</html>